"use strict";function e(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function r(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,r){return(a=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function i(e,r){return!r||"object"!=typeof r&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function o(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,a=n(e);if(r){var o=n(this).constructor;t=Reflect.construct(a,arguments,o)}else t=a.apply(this,arguments);return i(this,t)}}function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function c(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return s(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?s(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==t.return||t.return()}finally{if(c)throw i}}}}var l={CREATESESSION:1,RUN:2,CLOSE:3,CREATE_SESSION_WITH_WAITING:4,GET_LABEL:5},u={MODEL_ID:"modelId",INPUT:"input",SESSION_ID:"sessionId",SUCCESS:"success",FAIL:"fail",COMPLETE:"complete",OP:"op",MINVERSION:"minVersion",AI_SESSION:"aiSession"};function y(e){var r=[],t="";for(var n in e)r.push(e[n]);return r.length>0&&(r.sort(),t=r.join(".")),t}function d(e,r){var t={};return t.errCode=e,t.errMsg=r,t}function f(e,r){e=e.split("."),r=r.split(".");for(var t=Math.max(e.length,r.length);e.length<t;)e.push("0");for(;r.length<t;)r.push("0");for(var n=0;n<t;n++){var a=parseInt(e[n]),i=parseInt(r[n]);if(a>i)return 1;if(a<i)return-1}return 0}var v=function(){function r(t){e(this,r),this.id=t}return t(r,[{key:"run",value:function(e,r){var t={};t[u.OP]=l.RUN,t[u.SESSION_ID]=this.id,t[u.INPUT]=e,t[u.COMPLETE]=function(e){0===e[u.SESSION_ID]&&delete e[u.SESSION_ID],r(e)},Almighty.aiSession(t)}},{key:"getLabel",value:function(e){var r={};r[u.OP]=l.GET_LABEL,r[u.SESSION_ID]=this.id,r[u.COMPLETE]=function(r){0===r[u.SESSION_ID]&&delete r[u.SESSION_ID],e(r)},Almighty.aiSession(r)}},{key:"close",value:function(e){var r={};r[u.OP]=l.CLOSE,r[u.SESSION_ID]=this.id,r[u.COMPLETE]=function(r){0===r[u.SESSION_ID]&&delete r[u.SESSION_ID],e(r)},Almighty.aiSession(r)}}]),r}(),S={};function p(e){var r=function(e){e.data instanceof Date?(e.type="date",e.data=e.data.getTime().toString()):e.data instanceof Array?(e.type="array",e.data=JSON.stringify(e.data)):"number"==typeof e.data?(e.type="number",e.data=e.data.toString()):"boolean"==typeof e.data?(e.type="boolean",e.data=e.data.toString()):"string"==typeof e.data?e.type="string":e.data instanceof Object?(e.type="object",e.data=JSON.stringify(e.data)):console.warn("ConvertReq: data type not support")},t=function(e){"date"===e.type?e.data=new Date(Number(e.data)):"array"===e.type||"object"===e.type?e.data=JSON.parse(e.data):"boolean"===e.type?e.data=Boolean("true"===e.data):"number"===e.type&&(e.data=Number(e.data)),delete e.type},n=e.setStorage;e.setStorage=function(e){r(e),n(e)};var a=e.setStorageSync;e.setStorageSync=function(e){return r(e),a(e)};var i=e.getStorage;e.getStorage=function(e){!function(e){if(e.success){var r=e.success;e.success=function(e){t(e),r(e)}}if(e.fail){var n=e.fail;e.fail=function(e){t(e),n(e)}}if(e.complete){var a=e.complete;e.complete=function(e){t(e),a(e)}}}(e),i(e)};var o=e.getStorageSync;if(e.getStorageSync=function(e){var r=o(e);return t(r),r},e.createAiSession=function(r,t,n){h(l.CREATESESSION,e,r,t,n)},e.createAiSessionWithWaiting=function(r,t,n){h(l.CREATE_SESSION_WITH_WAITING,e,r,t,n)},e.abTestListener){var s=e.getAbTestSync;e.getAbTestSync=function(r){var t={},n=r.key;return t.key=n,void 0===S[n]&&(S[n]=s(r),e.abTestListener.register(t,(function(e){var r=S[n];r.value=e,S[n]=r}))),S[n]}}}function h(e,r,t,n,a){if(a=a||0,t){var i={};i[u.OP]=e,i[u.MODEL_ID]=t,i[u.MINVERSION]=a,i[u.SUCCESS]=function(e){0===e[u.SESSION_ID]&&delete e[u.SESSION_ID];var r=e[u.SESSION_ID];r?(e[u.AI_SESSION]=new v(r),n(e)):n(d(1,"create session failed: return sessionId is null."))},i[u.FAIL]=function(e){0===e[u.SESSION_ID]&&delete e[u.SESSION_ID],n(e)},r.aiSession(i)}else n(d(1,"modelId is null"))}var g,D=function(){function r(t,n){e(this,r),this.bridge=t,this.jssdk=n,this.syncDataZone={},this.syncDataListener={}}return t(r,[{key:"addListener",value:function(e,r){if(e)if("function"==typeof r){var t=this.syncDataListener[e];t||(t=[],this.syncDataListener[e]=t),t.push(r)}else console.error("DataSync addListener: listener is not function");else console.error("DataSync addListener: key is undefined")}},{key:"removeListener",value:function(e,r){if(e)if("function"==typeof r){var t=this.syncDataListener[e];if(t){for(var n,a=0,i=t.length;a<i;a++)if(t[a]===r){n=a;break}void 0!==n&&t.slice(n,1)}}else console.error("DataSync addListener: listener is not function");else console.error("DataSync addListener: key is undefined")}},{key:"startSyncData",value:function(e,r,t){var n=this;if(!e)return console.error("startSyncData: Key is null!"),void(r&&r({errCode:2,errMsg:"Params Error"}));if(this.syncDataZone[e]&&this.syncDataZone[e].arrayIdPath===t)r&&r({errCode:0});else{var a={key:e,operationType:"start",idPath:t},i=this.jssdk.allocateId();this.jssdk.on(i,(function(a){if(0===a.errCode){var i=n.onStartSyncData(e,t);r&&r(i)}else r&&r(a)})),this.bridge.syncDataFromJS(JSON.stringify(a),i)}}},{key:"stopSyncData",value:function(e,r){var t=this;if(!e)return console.error("stopSyncData: Key is null!"),void(r&&r({errCode:2,errMsg:"Params Error"}));if(this.syncDataZone[e]){var n={key:e,operationType:"stop"},a=this.jssdk.allocateId();this.jssdk.on(a,(function(e){if(0===e.errCode){var a=t.onStopSyncData(n.key);r&&r(a)}else r&&r(e)})),this.bridge.syncDataFromJS(JSON.stringify(n),a)}else r&&r({errCode:1,errMsg:"DataSync has already stoped!"})}},{key:"setArrayData",value:function(e,r,t){var n=this;if(!e||!Array.isArray(r))return console.error("DataSync setArrayData: Key: ".concat(e," is null or data is not array!")),void(t&&t({errCode:2,errMsg:"Params Error"}));var a={key:e,operationType:"setArray",changedData:r},i=this.jssdk.allocateId();this.jssdk.on(i,(function(a){if(0===a.errCode){var i=n.onSetArrayData(e,r);t&&t(i)}else t&&t(a)})),this.bridge.syncDataFromJS(JSON.stringify(a),i)}},{key:"getArrayData",value:function(e){if(e){var r=this.syncDataZone[e];if(r){var t=r.arrayIdList,n=r.arrayData;if(t){if(!n)return[];for(var a=[],i=0,o=t.length;i<o;i++){var s=t[i];n[s]?a.push(n[s]):console.error("DataSync getArrayData: Data object for id: ".concat(s," is not exist"))}return a}console.error("DataSync getArrayData: idList for key: ".concat(e," is not initialized"))}else console.error("DataSync getArrayData: syncDataZone for key: ".concat(e," is not initialized"))}else console.error("DataSync getArrayData: Key is null!")}},{key:"appendArrayData",value:function(e,r,t){var n=this;if(!e||!Array.isArray(r))return console.error("DataSync appendArrayData: Key: ".concat(e," is null or data: ").concat(r," is not array!")),void(t&&t({errCode:2,errMsg:"Params Error"}));var a={key:e,operationType:"appendArray",changedData:r},i=this.jssdk.allocateId();this.jssdk.on(i,(function(a){if(0===a.errCode){var i=n.onAppendArrayData(e,r);t&&t(i)}else t&&t(a)})),this.bridge.syncDataFromJS(JSON.stringify(a),i)}},{key:"setStringData",value:function(e,r,t,n){var a=this;if(!e||null==r)return console.error("DataSync setStringData: Key: ".concat(e," is null or data is null!")),void(t&&t({errCode:2,errMsg:"Params Error"}));var i={key:e,operationType:"setString",changedData:r,disposable:n,timestamp:(new Date).getTime()},o=this.jssdk.allocateId();this.jssdk.on(o,(function(o){if(0===o.errCode){var s=a.onSetStringData(e,r,n,i.timestamp);t&&t(s)}else t&&t(o)})),this.bridge.syncDataFromJS(JSON.stringify(i),o)}},{key:"getStringData",value:function(e){if(e){var r=this.syncDataZone[e];if(r){if(r.stringData){var t=r.stringData,n=t.data;return t.disposable&&this.setStringData(e,""),n}}else console.error("DataSync getStringData: syncDataZone for key: ".concat(e," is not initialized"))}else console.error("DataSync getStringData: Key is null!")}},{key:"peekStringData",value:function(e){if(e){var r=this.syncDataZone[e];if(r){if(r.stringData)return r.stringData.data}else console.error("DataSync peekStringData: syncDataZone for key: ".concat(e," is not initialized"))}else console.error("DataSync peekStringData: Key is null!")}},{key:"removeArrayData",value:function(e,r,t){var n=this;if(!e||!Array.isArray(r))return console.error("DataSync removeArrayData: Key: ".concat(e," is null or data: ").concat(r," is not array!")),void(t&&t({errCode:2,errMsg:"Params Error"}));var a=this.syncDataZone[e];if(!a)return console.error("DataSync removeArrayData: DataSync is not started!"),void(t&&t({errCode:1,errMsg:"DataSync is not started"}));var i=a.arrayIdPath;if(!i)return console.error("DataSync removeArrayData: idPath is not setted!"),void(t&&t({errCode:1,errMsg:"IdPath is not setted!"}));var o=r.map((function(e){return e[i]})),s={key:e,operationType:"removeArray",changedData:o},c=this.jssdk.allocateId();this.jssdk.on(c,(function(r){if(0===r.errCode){var a=n.onRemoveArrayData(e,o);t&&t(a)}else t&&t(r)})),this.bridge.syncDataFromJS(JSON.stringify(s),c)}},{key:"sortArrayData",value:function(e,r,t){if(!e||!Array.isArray(r))return console.error("DataSync sortArrayData: Key: ".concat(e," is null or data: ").concat(r," is not array!")),void(t&&t({errCode:2,errMsg:"Params Error"}));var n=this.syncDataZone[e];if(!n)return console.error("DataSync sortArrayData: DataSync is not started!"),void(t&&t({errCode:1,errMsg:"DataSync is not started"}));var a=n.arrayIdPath,i=n.arrayIdList,o={};i.forEach((function(e){o[e]=1}));for(var s=[],c=0,l=r.length;c<l;c++){var u=r[c][a];o[u]?(s.push(u),delete o[u]):console.info("DataSync sortArrayData: id sorted is not in idList")}for(var e in o)s.push(e);var y=!1,d=0;for(l=Math.min(s.length,i.length);d<l;d++){var f=s[d];if(i[d]!==f){y=!0;break}}if(!y)return console.log("DataSync sortArrayData: Data has not changed, compelte now!"),void(t&&t({errCode:0}));n.arrayIdList=s;var v={key:e,operationType:"sortArray",changedData:s},S=this.jssdk.allocateId();this.jssdk.on(S,(function(e){t&&t(e)})),this.bridge.syncDataFromJS(JSON.stringify(v),S)}},{key:"syncDataFromNative",value:function(e){if(!e||!e.key||!e.operationType)return console.error("DataSync syncDataFromNative: Params Error: ".concat(JSON.stringify(e))),JSON.stringify({errCode:2,errMsg:"Params Error"});var r;switch(e.operationType){case"setArray":r=this.onSetArrayData(e.key,e.changedData);break;case"appendArray":r=this.onAppendArrayData(e.key,e.changedData);break;case"removeArray":r=this.onRemoveArrayData(e.key,e.changedData);break;case"start":r=this.onStartSyncData(e.key,e.arrayIdPath);break;case"stop":r=this.onStopSyncData(e.key);break;case"setString":r=this.onSetStringData(e.key,e.changedData,e.disposable,e.timestamp,!0)}if("setArray"===e.operationType||"appendArray"===e.operationType||"removeArray"===e.operationType||"setString"===e.operationType){var t=this.syncDataListener[e.key];if(t)for(var n=0,a=t.length;n<a;n++){var i=t[n];"function"==typeof i&&i(e)}}return JSON.stringify(r)}},{key:"onSetStringData",value:function(e,r,t,n,a){if(!e||null==r)return console.error("DataSync onSetStringData: Key or data is null!"),{errCode:2,errMsg:"Params Error"};var i=this.syncDataZone[e];if(!i)return console.error("DataSync onSetStringData: Data is null!"),{errCode:1,errMsg:"DataSync is not started"};if(a&&(n&&i.stringData&&i.stringData.timestamp&&(new Date).getTime()>=i.stringData.timestamp&&n<i.stringData.timestamp))return{errCode:0};return i.stringData={data:r,disposable:t,timestamp:n},{errCode:0}}},{key:"onSetArrayData",value:function(e,r){if(!e||!r)return console.error("DataSync onSetData: Key or data is null!"),{errCode:2,errMsg:"Params Error"};var t=this.syncDataZone[e];if(!t)return console.error("DataSync onSetData: Data is null!"),{errCode:1,errMsg:"DataSync is not started"};for(var n=t.arrayIdPath,a=[],i={},o=0,s=r.length;o<s;o++){var c=r[o],l=c[n];i[l]||a.push(l),i[l]=c}return t.arrayIdList=a,t.arrayData=i,{errCode:0}}},{key:"onAppendArrayData",value:function(e,r){if(!e||!r)return console.error("DataSync onAppendData: Key or data is null!"),{errCode:2,errMsg:"Params Error"};var t=this.syncDataZone[e];if(!t)return console.error("DataSync onAppendData: Data is null!"),{errCode:1,errMsg:"DataSync is not started"};for(var n=t.arrayIdPath,a=t.arrayIdList,i=t.arrayData,o=0,s=r.length;o<s;o++){var c=r[o],l=c[n];i[l]||a.push(l),i[l]=c}return{errCode:0}}},{key:"onRemoveArrayData",value:function(e,r){if(!e||!r)return console.error("DataSync onAppendData: Key or data is null!"),{errCode:2,errMsg:"Params Error"};var t=this.syncDataZone[e];if(!t)return console.error("DataSync onAppendData: Data is null!"),{errCode:1,errMsg:"DataSync is not started"};for(var n=t.arrayIdList,a=t.arrayData,i=0,o=r.length;i<o;i++){var s=r[i];a[s]&&delete a[s]}return n=n.filter((function(e){return void 0!==a[e]})),t.arrayIdList=n,{errCode:0}}},{key:"onStartSyncData",value:function(e,r){if(!e)return console.error("DataSync onAppendData: Key is null!"),{errCode:2,errMsg:"Params Error"};if(this.syncDataZone[e]&&this.syncDataZone[e].arrayIdPath===r)return{errCode:0};var t={idPath:r,dataMap:{},idList:[]};return this.syncDataZone[e]=t,{errCode:0}}},{key:"onStopSyncData",value:function(e){return e?this.syncDataZone[e]?(delete this.syncDataZone[e],delete this.syncDataListener[e],{errCode:0}):{errCode:1,errMsg:"DataSync is already stoped"}:(console.error("DataSync onAppendData: Key is null!"),{errCode:2,errMsg:"Params Error"})}}]),r}(),k=function(){function r(t){e(this,r),this.bridge=t,this.service={}}return t(r,[{key:"invokeCallback",value:function(e,r){"function"==typeof e?e(r):"number"==typeof e?this.bridge.onJSCallback(e,JSON.stringify(r)):console.warn("Service callback: ".concat(e," is illegal"))}},{key:"registerService",value:function(e){if(e.id&&0!==e.id.length){var r=this.service[e.id];for(var t in r||(r={},this.service[e.id]=r),e)"id"!==t&&("function"==typeof e[t]?r[t]=e[t]:console.warn("Service registerService: ".concat(t," is not a function")))}else console.error("Service registerService: id is null")}},{key:"callServiceSync",value:function(e,r,t){var n=this.checkServiceInput(e,r);if(0!==n.errCode)return n;var a=(0,this.service[e][r])(t);return void 0===a.errCode&&(a.errCode=0),JSON.stringify(a)}},{key:"callServiceAsync",value:function(e,r,t,n){var a=this.checkServiceInput(e,r);0===a.errCode?(0,this.service[e][r])(t,function(e){void 0===e.errCode&&(e.errCode=0),n&&this.invokeCallback(n,e)}.bind(this)):this.invokeCallback(n,a)}},{key:"checkServiceInput",value:function(e,r){var t={errCode:0};if(!e||0===e.length)return console.warn("Service checkServiceInput: id is null"),t.errCode=2,t.errMsg="Parameters Error",t;if(!r||0===r.length)return console.warn("Service checkServiceInput: action is null"),t.errCode=2,t.errMsg="Parameters Error",t;var n=this.service[e];return n?(n[r]||(console.warn("Service checkServiceInput: service action is not supported"),t.errCode=4,t.errMsg="Not Support"),t):(console.warn("Service checkServiceInput: service is not supported"),t.errCode=4,t.errMsg="Not Support",t)}},{key:"setupSortService",value:function(e){e.registerSortService=function(r){3===Object.keys(r).length&&r.id&&r.onDataChanged&&r.sortData?(this.registerService(r),e.DataSync.addListener(r.id,function(t){var n=e.DataSync.getArrayData(r.id);this.callServiceAsync(r.id,"onDataChanged",n)}.bind(this))):console.error("Service registerSortService: Params Error")}.bind(this),e.Service.triggerSort=function(r){if(r&&r.id){var t=r.id,n=r.complete,a=e.DataSync.getArrayData(t);if(a)this.callServiceAsync(t,"sortData",a,function(r){r.result?e.DataSync.sortArrayData(t,r.result,function(e){this.invokeCallback(n,e)}.bind(this)):this.invokeCallback(n,r)}.bind(this));else{this.invokeCallback(n,{errCode:1,errMsg:"Data to sort is empty"})}}else{console.error("Service triggerSort: Params Error");r&&this.invokeCallback(r.complete,{errCode:2,errMsg:"Params Error"})}}.bind(this)}}]),r}(),m=function(){function r(t){e(this,r),this.callback={},this.bridge=t,this.service={}}return t(r,[{key:"on",value:function(e,r){var t=this.callback[e]||[];-1===t.indexOf(r)&&(t.push(r),this.callback[e]=t)}},{key:"off",value:function(e,r){var t=(this.callback[e]||[]).indexOf(r);t>=0&&this.callback[e].splice(t,1)}},{key:"invokeCallback",value:function(e,r){void 0!==e?((this.callback[e]||[]).forEach((function(e){e&&e(r)})),delete this.callback[e]):console.warn("invokeCallback callbackId is null")}},{key:"dispatchJsEvent",value:function(e,r){(this.callback[e]||[]).forEach((function(e){e&&e(r)}))}}]),r}(),b=function(){function r(t,n){e(this,r),this.name=t,this.jsSdk=n}return t(r,[{key:"register",value:function(e,r){var t={};if(!e)return console.error("JsApiListener register: keyList is null"),d(1,"keyList is null.");var n=y(e);this.jsSdk.jsApiListenerMap[this.name]||(this.jsSdk.jsApiListenerMap[this.name]={});var a=this.jsSdk.jsApiListenerMap[this.name],i=a[n];if(!i||0===i.length){t.type=1,t.keyList=e;var o=this.jsSdk.callNativeSync(this.name,t);return 0===o.errCode&&((i=[]).push(r),a[n]=i),console.info("JsApi listener register with native: ".concat(this.name)),o}return-1!==i.indexOf(r)?d(1,"listener is already existed."):(i.push(r),console.info("JsApi listener register: ".concat(this.name)),d(0,""))}},{key:"unregister",value:function(e,r){var t=y(e=e||{}),n=this.jsSdk.jsApiListenerMap[this.name];if(!n)return console.error("JsApiListener unregister: listeners for jsapi is empty"),d(1,"listener is not found.");var a=n[t];if(!a||0===a.length)return console.error("JsApiListener unregister: listeners for key is empty"),d(1,"listener is not found.");var i=a.indexOf(r);if(-1===i)return console.error("JsApiListener unregister: listener is not found"),d(1,"listener is not found.");if(a.splice(i,1),0===a.length){var o={type:0};o.keyList=e;var s=this.jsSdk.callNativeSync(this.name,o);return s&&0===s.errCode||a.push(r),console.info("JsApi listener unregister with native: ".concat(this.name)),s}return console.info("JsApi listener unregister: ".concat(this.name)),d(0,"")}}]),r}(),A=function(r){!function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&a(e,r)}(i,m);var n=o(i);function i(r){var t;return e(this,i),(t=n.call(this,r)).jsApiListenerMap={},t.appVersionResMap={},t.systemVersionResMap={},t}return t(i,[{key:"addJSApi",value:function(e,r){var t=this;r.forEach((function(r){var n=r.endsWith("Sync"),a=r.endsWith("Listener");e[r]=a?new b(r,t):n?function(e){e=e||{};var n={};return Object.keys(e).forEach((function(r){"function"!=typeof e[r]&&(n[r]=e[r])})),console.info("JsApi invoke sync: "+r),t.callNativeSync(r,n)}:function(e){e=e||{};var n=t.allocateId(),a={};Object.keys(e).forEach((function(r){"function"!=typeof e[r]&&(a[r]=e[r])})),t.on(n,(function(r){r.errCode&&0!==r.errCode?e.fail&&e.fail(r||{}):e.success&&e.success(r||{}),e.complete&&e.complete(r||{})})),console.info("JsApi invoke async: "+r),t.callNativeAsync(r,a,n)}}))}},{key:"isSupport",value:function(e,r){if(!r||0===r.length)return console.error("isSupport: Schema format is not correct!"),!1;var t=r.split(".");if(0===t.length)return console.error("isSupport: Schema format is not correct!"),!1;if("Almighty"!==t[0])return this.isPropertyExist(e,t);if(t.shift(),0===t.length)return!0;var n=t[0];if(!e.Almighty[n])return!1;var a=this.bridge.JSAPIDefine&&this.bridge.JSAPIDefine[n];return a?(t.shift(),0===t.length||this.isPropertyExist(a,t)):this.isPropertyExist(e.Almighty,t)}},{key:"isPropertyExist",value:function(e,r){if(!r||0===r.length)return!0;var t=r.shift();return void 0!==e[t]&&this.isPropertyExist(e[t],r)}},{key:"isDebug",value:function(){return"debug"===this.bridge.environment}},{key:"compareAppVersionWith",value:function(e){var r=this.bridge.appVersion,t=e;return r&&t?(this.appVersionResMap[t]||(this.appVersionResMap[t]=f(r,t)),this.appVersionResMap[t]):-1}},{key:"compareSystemVersionWith",value:function(e){var r=this.bridge.systemVersion,t=e;return r&&t?(this.systemVersionResMap[t]||(this.systemVersionResMap[t]=f(r,t)),this.systemVersionResMap[t]):-1}},{key:"addNativeEvent",value:function(e,r){r.forEach((function(r){e[r]=function(t){e.on(r,(function(e){t&&t(e)}))}}))}},{key:"callNativeAsync",value:function(e,r,t){try{if(!this.bridge)return console.warn("callNativeAsync, Bridge is undefined"),void this.callbackFromNative(t,{errCode:6,errMsg:"Framework Error"});this.bridge.invokeAsync(e,JSON.stringify(r),t)}catch(r){console.error("callNativeAsync, call jsapi:".concat(e," failed!"))}}},{key:"callNativeSync",value:function(e,r){try{if(!this.bridge)return console.warn("callNativeSync, Bridge is undefined"),{errCode:6,errMsg:"Framework Error"};var t=this.bridge.invokeSync(e,JSON.stringify(r));return t=JSON.parse(t)}catch(r){console.error("callNativeSync call jsapi:".concat(e," failed!"))}return{errCode:7,errMsg:"Native Return Invalid Data"}}},{key:"dispatch",value:function(e,r,t){this.bridge?this.bridge.dispatch(e,JSON.stringify(r),t):console.error("dispatch error: Bridge is undefined")}},{key:"allocateId",value:function(){return this.idPool=this.idPool||0,++this.idPool}}]),i}();void 0===String.prototype.endsWith&&(String.prototype.endsWith=function(e){return new RegExp(e+"$").test(this)}),g=function(e,r,t){if(!e.Almighty){var n=new A(__JSBridge),a=new D(__JSBridge,n),i=new k(__JSBridge);__JSBridge=void 0;try{Object.defineProperty(e,"Almighty",{value:{onNativeEvent:n.dispatchJsEvent.bind(n),onNativeCallback:n.invokeCallback.bind(n),on:n.on.bind(n),isSupport:n.isSupport.bind(n,e),Env:{mode:n.bridge.environment,isDebug:n.isDebug.bind(n),appVersion:n.bridge.appVersion,platform:n.bridge.platform,systemVersion:n.bridge.systemVersion,pluginId:n.bridge.pluginId,compareAppVersionWith:n.compareAppVersionWith.bind(n),compareSystemVersionWith:n.compareSystemVersionWith.bind(n)},Service:{registerService:i.registerService.bind(i),callServiceSync:i.callServiceSync.bind(i),callServiceAsync:i.callServiceAsync.bind(i)},DataSync:{syncDataFromNative:a.syncDataFromNative.bind(a),addListener:a.addListener.bind(a),removeListener:a.removeListener.bind(a),startSyncData:a.startSyncData.bind(a),stopSyncData:a.stopSyncData.bind(a),setArrayData:a.setArrayData.bind(a),appendArrayData:a.appendArrayData.bind(a),removeArrayData:a.removeArrayData.bind(a),sortArrayData:a.sortArrayData.bind(a),getArrayData:a.getArrayData.bind(a),getStringData:a.getStringData.bind(a),setStringData:a.setStringData.bind(a),peekStringData:a.peekStringData.bind(a)}},writable:!1,configurable:!1})}catch(e){console.error("setupAlmighty: Define Almighty failed!")}return n.addJSApi(e.Almighty,r),n.addNativeEvent(e.Almighty,t),i.setupSortService(e.Almighty),n}console.info("setupAlmighty: Almighty has defined, skip")}(this,JSApiList,["onDispatchData","onReady","onDestroy","onListenerNotified"]),p(Almighty),function(e,r){e.onListenerNotified((function(e){var t=y(e.keyList),n=e.value,a=e.jsApi;if(!t||!a)return console.error("onListenerNotified: key or jsApi is null. key: ".concat(t,", jsapi: ").concat(a)),null;var i=r.jsApiListenerMap[a];if(i)if(i[t]){var o=i[t].slice(0);console.info("onListenerNotified: key: ".concat(t,", jsapi: ").concat(a));var s,l=c(o);try{for(l.s();!(s=l.n()).done;)(0,s.value)(n)}catch(e){l.e(e)}finally{l.f()}}else console.warn("onListenerNotified: listener is null. key: ".concat(t,", jsapi: ").concat(a));else console.warn("onListenerNotified: jsApiListenerMap is null. jsapi: ".concat(a))}))}(Almighty,g),function(e,r){var t=console.log.bind(console);console.log=function(){if(e.Env.isDebug()){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=a.join(" ");t(r+": "+o)}};var n=console.warn.bind(console);console.warn=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i=t.join(" ");n(r+": "+i)};var a=console.error.bind(console);console.error=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.join(" ");a(r+": "+i)};var i=console.info.bind(console);console.info=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t.join(" ");i(r+": "+a)};var o=console.debug.bind(console);console.debug=function(){if(e.Env.isDebug()){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];var i=n.join(" ");o(r+": "+i)}}}(Almighty,Almighty.Env.pluginId),console.log("evaluate Service common-library script finish.");
//# sourceMappingURL=Service.js.map
